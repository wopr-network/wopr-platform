{
  "version": "6",
  "dialect": "sqlite",
  "id": "966b95ae-03b8-405e-9c82-dc8fb8f799df",
  "prevId": "b5d52f99-7e5e-4061-9bf4-ec8221089371",
  "tables": {
    "credit_balances": {
      "name": "credit_balances",
      "columns": {
        "tenant_id": {
          "name": "tenant_id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "balance_cents": {
          "name": "balance_cents",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": 0
        },
        "last_updated": {
          "name": "last_updated",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "(datetime('now'))"
        }
      },
      "indexes": {},
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "credit_transactions": {
      "name": "credit_transactions",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "tenant_id": {
          "name": "tenant_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "amount_cents": {
          "name": "amount_cents",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "balance_after_cents": {
          "name": "balance_after_cents",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "type": {
          "name": "type",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "reference_id": {
          "name": "reference_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "created_at": {
          "name": "created_at",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "(datetime('now'))"
        }
      },
      "indexes": {
        "credit_transactions_reference_id_unique": {
          "name": "credit_transactions_reference_id_unique",
          "columns": [
            "reference_id"
          ],
          "isUnique": true
        },
        "idx_credit_tx_tenant": {
          "name": "idx_credit_tx_tenant",
          "columns": [
            "tenant_id"
          ],
          "isUnique": false
        },
        "idx_credit_tx_type": {
          "name": "idx_credit_tx_type",
          "columns": [
            "type"
          ],
          "isUnique": false
        },
        "idx_credit_tx_ref": {
          "name": "idx_credit_tx_ref",
          "columns": [
            "reference_id"
          ],
          "isUnique": false
        },
        "idx_credit_tx_created": {
          "name": "idx_credit_tx_created",
          "columns": [
            "created_at"
          ],
          "isUnique": false
        },
        "idx_credit_tx_tenant_created": {
          "name": "idx_credit_tx_tenant_created",
          "columns": [
            "tenant_id",
            "created_at"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "email_notifications": {
      "name": "email_notifications",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "tenant_id": {
          "name": "tenant_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "email_type": {
          "name": "email_type",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "sent_at": {
          "name": "sent_at",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "(datetime('now'))"
        },
        "sent_date": {
          "name": "sent_date",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_email_notif_tenant": {
          "name": "idx_email_notif_tenant",
          "columns": [
            "tenant_id"
          ],
          "isUnique": false
        },
        "idx_email_notif_type": {
          "name": "idx_email_notif_type",
          "columns": [
            "email_type"
          ],
          "isUnique": false
        },
        "uniq_email_per_day": {
          "name": "uniq_email_per_day",
          "columns": [
            "tenant_id",
            "email_type",
            "sent_date"
          ],
          "isUnique": true
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "billing_period_summaries": {
      "name": "billing_period_summaries",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "tenant": {
          "name": "tenant",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "capability": {
          "name": "capability",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "provider": {
          "name": "provider",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "event_count": {
          "name": "event_count",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "total_cost": {
          "name": "total_cost",
          "type": "real",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "total_charge": {
          "name": "total_charge",
          "type": "real",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "total_duration": {
          "name": "total_duration",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": 0
        },
        "period_start": {
          "name": "period_start",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "period_end": {
          "name": "period_end",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_billing_period_unique": {
          "name": "idx_billing_period_unique",
          "columns": [
            "tenant",
            "capability",
            "provider",
            "period_start"
          ],
          "isUnique": true
        },
        "idx_billing_period_tenant": {
          "name": "idx_billing_period_tenant",
          "columns": [
            "tenant",
            "period_start"
          ],
          "isUnique": false
        },
        "idx_billing_period_window": {
          "name": "idx_billing_period_window",
          "columns": [
            "period_start",
            "period_end"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "meter_events": {
      "name": "meter_events",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "tenant": {
          "name": "tenant",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "cost": {
          "name": "cost",
          "type": "real",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "charge": {
          "name": "charge",
          "type": "real",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "capability": {
          "name": "capability",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "provider": {
          "name": "provider",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "timestamp": {
          "name": "timestamp",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "session_id": {
          "name": "session_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "duration": {
          "name": "duration",
          "type": "integer",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_meter_tenant": {
          "name": "idx_meter_tenant",
          "columns": [
            "tenant"
          ],
          "isUnique": false
        },
        "idx_meter_timestamp": {
          "name": "idx_meter_timestamp",
          "columns": [
            "timestamp"
          ],
          "isUnique": false
        },
        "idx_meter_capability": {
          "name": "idx_meter_capability",
          "columns": [
            "capability"
          ],
          "isUnique": false
        },
        "idx_meter_session": {
          "name": "idx_meter_session",
          "columns": [
            "session_id"
          ],
          "isUnique": false
        },
        "idx_meter_tenant_timestamp": {
          "name": "idx_meter_tenant_timestamp",
          "columns": [
            "tenant",
            "timestamp"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "usage_summaries": {
      "name": "usage_summaries",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "tenant": {
          "name": "tenant",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "capability": {
          "name": "capability",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "provider": {
          "name": "provider",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "event_count": {
          "name": "event_count",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "total_cost": {
          "name": "total_cost",
          "type": "real",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "total_charge": {
          "name": "total_charge",
          "type": "real",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "total_duration": {
          "name": "total_duration",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": 0
        },
        "window_start": {
          "name": "window_start",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "window_end": {
          "name": "window_end",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_summary_tenant": {
          "name": "idx_summary_tenant",
          "columns": [
            "tenant",
            "window_start"
          ],
          "isUnique": false
        },
        "idx_summary_window": {
          "name": "idx_summary_window",
          "columns": [
            "window_start",
            "window_end"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "stripe_usage_reports": {
      "name": "stripe_usage_reports",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "tenant": {
          "name": "tenant",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "capability": {
          "name": "capability",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "provider": {
          "name": "provider",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "period_start": {
          "name": "period_start",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "period_end": {
          "name": "period_end",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "event_name": {
          "name": "event_name",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "value_cents": {
          "name": "value_cents",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "reported_at": {
          "name": "reported_at",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_stripe_usage_unique": {
          "name": "idx_stripe_usage_unique",
          "columns": [
            "tenant",
            "capability",
            "provider",
            "period_start"
          ],
          "isUnique": true
        },
        "idx_stripe_usage_tenant": {
          "name": "idx_stripe_usage_tenant",
          "columns": [
            "tenant",
            "reported_at"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "tenant_customers": {
      "name": "tenant_customers",
      "columns": {
        "tenant": {
          "name": "tenant",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "stripe_customer_id": {
          "name": "stripe_customer_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "tier": {
          "name": "tier",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "'free'"
        },
        "billing_hold": {
          "name": "billing_hold",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": 0
        },
        "created_at": {
          "name": "created_at",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "updated_at": {
          "name": "updated_at",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        }
      },
      "indexes": {
        "tenant_customers_stripe_customer_id_unique": {
          "name": "tenant_customers_stripe_customer_id_unique",
          "columns": [
            "stripe_customer_id"
          ],
          "isUnique": true
        },
        "idx_tenant_customers_stripe": {
          "name": "idx_tenant_customers_stripe",
          "columns": [
            "stripe_customer_id"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "audit_log": {
      "name": "audit_log",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "timestamp": {
          "name": "timestamp",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "auth_method": {
          "name": "auth_method",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "action": {
          "name": "action",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "resource_type": {
          "name": "resource_type",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "resource_id": {
          "name": "resource_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "details": {
          "name": "details",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_audit_timestamp": {
          "name": "idx_audit_timestamp",
          "columns": [
            "timestamp"
          ],
          "isUnique": false
        },
        "idx_audit_user_id": {
          "name": "idx_audit_user_id",
          "columns": [
            "user_id"
          ],
          "isUnique": false
        },
        "idx_audit_action": {
          "name": "idx_audit_action",
          "columns": [
            "action"
          ],
          "isUnique": false
        },
        "idx_audit_resource": {
          "name": "idx_audit_resource",
          "columns": [
            "resource_type",
            "resource_id"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "admin_audit_log": {
      "name": "admin_audit_log",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "admin_user": {
          "name": "admin_user",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "action": {
          "name": "action",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "category": {
          "name": "category",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "target_tenant": {
          "name": "target_tenant",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "target_user": {
          "name": "target_user",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "details": {
          "name": "details",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "'{}'"
        },
        "ip_address": {
          "name": "ip_address",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "user_agent": {
          "name": "user_agent",
          "type": "text",
          "primaryKey": false,
          "notNull": false,
          "autoincrement": false
        },
        "created_at": {
          "name": "created_at",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_admin_audit_admin": {
          "name": "idx_admin_audit_admin",
          "columns": [
            "admin_user",
            "created_at"
          ],
          "isUnique": false
        },
        "idx_admin_audit_tenant": {
          "name": "idx_admin_audit_tenant",
          "columns": [
            "target_tenant",
            "created_at"
          ],
          "isUnique": false
        },
        "idx_admin_audit_action": {
          "name": "idx_admin_audit_action",
          "columns": [
            "action",
            "created_at"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {}
    },
    "snapshots": {
      "name": "snapshots",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true,
          "autoincrement": false
        },
        "instance_id": {
          "name": "instance_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "created_at": {
          "name": "created_at",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "(datetime('now'))"
        },
        "size_mb": {
          "name": "size_mb",
          "type": "real",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": 0
        },
        "trigger": {
          "name": "trigger",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        },
        "plugins": {
          "name": "plugins",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "'[]'"
        },
        "config_hash": {
          "name": "config_hash",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false,
          "default": "''"
        },
        "storage_path": {
          "name": "storage_path",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "autoincrement": false
        }
      },
      "indexes": {
        "idx_snapshots_instance": {
          "name": "idx_snapshots_instance",
          "columns": [
            "instance_id",
            "\"created_at\" desc"
          ],
          "isUnique": false
        },
        "idx_snapshots_user": {
          "name": "idx_snapshots_user",
          "columns": [
            "user_id"
          ],
          "isUnique": false
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "checkConstraints": {
        "trigger_check": {
          "name": "trigger_check",
          "value": "trigger IN ('manual', 'scheduled', 'pre_update')"
        }
      }
    }
  },
  "views": {},
  "enums": {},
  "_meta": {
    "schemas": {},
    "tables": {},
    "columns": {}
  },
  "internal": {
    "indexes": {
      "idx_snapshots_instance": {
        "columns": {
          "\"created_at\" desc": {
            "isExpression": true
          }
        }
      }
    }
  }
}