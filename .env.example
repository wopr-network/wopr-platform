# wopr-platform environment variables.
#
# Copy this file and fill in real values:
#   cp .env.example .env
#
# Same docker-compose.yml is used for prod and staging — only this file differs.

# --- Domain ---
# Root domain for the platform. Caddy provisions TLS for {DOMAIN} and api.{DOMAIN}.
DOMAIN=wopr.bot

# --- Stripe ---
STRIPE_SECRET_KEY=sk_live_REPLACE_ME
STRIPE_WEBHOOK_SECRET=whsec_REPLACE_ME
STRIPE_DEFAULT_PRICE_ID=price_REPLACE_ME

# --- Auth (better-auth) ---
# Secret for signing session cookies. Generate with: openssl rand -hex 32
BETTER_AUTH_SECRET=REPLACE_ME

# --- Email (Resend) ---
RESEND_API_KEY=re_REPLACE_ME
RESEND_FROM_EMAIL=noreply@wopr.bot

# --- Cloudflare (optional — for Caddy DNS challenge behind proxied DNS) ---
CLOUDFLARE_API_TOKEN=

# --- Bot image ---
# Container image used when spawning tenant WOPR instances.
WOPR_BOT_IMAGE=ghcr.io/wopr-network/wopr:latest

# --- DO Spaces (backup storage) ---
# S3-compatible bucket for nightly full-filesystem backups.
# $5/mo for 250GB ($0.02/GB overage). Region should match droplets.
S3_BUCKET=wopr-backups
DO_SPACES_REGION=nyc3
DO_SPACES_ACCESS_KEY=REPLACE_ME
DO_SPACES_SECRET_KEY=REPLACE_ME

# --- Margin configuration ---
# JSON-encoded margin multiplier rules for the provider arbitrage gateway.
# Loaded by src/monetization/adapters/margin-config.ts at startup.
# If unset, falls back to a flat 1.3x default on all providers.
#
# Shape: { "defaultMargin": number, "rules": [{ "provider": string, "modelPattern": string, "margin": number }] }
# Multipliers: 1.3 = 30% margin, 1.5 = 50% margin. Typical range: 1.1–2.0.
#
# MARGIN_CONFIG_JSON={"defaultMargin":1.3,"rules":[]}

# --- Database ---
DATABASE_URL=postgresql://wopr:wopr@localhost:5432/wopr

# --- Platform Core ---
# Master secret for vault encryption, HMAC signing, and tenant key derivation.
# Generate with: openssl rand -hex 32 (must be >= 32 chars).
PLATFORM_SECRET=REPLACE_ME
# Separate encryption secret for setup profile encryption.
# Generate with: openssl rand -hex 32
PLATFORM_ENCRYPTION_SECRET=REPLACE_ME
# Public-facing URLs (defaults shown — override for custom domains).
# PLATFORM_URL=https://api.wopr.bot
# PLATFORM_DOMAIN=wopr.bot
# PLATFORM_UI_URL=https://app.wopr.bot
# APP_BASE_URL=https://app.wopr.bot
# UI_ORIGIN=http://localhost:3001
# COOKIE_DOMAIN=.wopr.bot

# --- Auth (better-auth) ---
# URL where the auth server is reachable.
BETTER_AUTH_URL=http://localhost:3100

# --- OAuth Providers (optional — enable by setting both ID and SECRET) ---
# GITHUB_CLIENT_ID=
# GITHUB_CLIENT_SECRET=
# DISCORD_CLIENT_ID=
# DISCORD_CLIENT_SECRET=
# GOOGLE_CLIENT_ID=
# GOOGLE_CLIENT_SECRET=

# --- Slack OAuth (optional) ---
# SLACK_CLIENT_ID=
# SLACK_CLIENT_SECRET=

# --- Email (Resend) ---
# RESEND_FROM=noreply@wopr.bot
# RESEND_REPLY_TO=support@wopr.bot

# --- Stripe Credit Prices ---
# Stripe Price IDs for credit purchase tiers.
# Create 5 Price objects under one "WOPR Credits" Product in Stripe Dashboard.
# Naming convention: STRIPE_CREDIT_PRICE_{DOLLAR_AMOUNT}
# Each maps to a preset tier: $5 (0% bonus), $10 (0%), $25 (2%), $50 (5%), $100 (10%).
STRIPE_CREDIT_PRICE_5=price_REPLACE_ME
STRIPE_CREDIT_PRICE_10=price_REPLACE_ME
STRIPE_CREDIT_PRICE_25=price_REPLACE_ME
STRIPE_CREDIT_PRICE_50=price_REPLACE_ME
STRIPE_CREDIT_PRICE_100=price_REPLACE_ME

# --- Stripe VPS ---
# Price ID for VPS subscription checkout (optional — only if VPS provisioning is enabled).
# STRIPE_VPS_PRICE_ID=price_REPLACE_ME

# --- PayRam (optional — crypto payments) ---
# PAYRAM_API_KEY=
# PAYRAM_BASE_URL=

# --- Gateway Providers (optional — enable by setting API key) ---
# OPENROUTER_API_KEY=
# DEEPGRAM_API_KEY=
# ELEVENLABS_API_KEY=
# REPLICATE_API_TOKEN=
# TWILIO_ACCOUNT_SID=
# TWILIO_AUTH_TOKEN=
# TELNYX_API_KEY=

# --- Gateway Rate Limits ---
# Requests per window per tenant. Defaults shown.
# GATEWAY_RATE_LIMIT_LLM=60
# GATEWAY_RATE_LIMIT_IMAGE=10
# GATEWAY_RATE_LIMIT_AUDIO=30
# GATEWAY_RATE_LIMIT_TELEPHONY=100

# --- Gateway Circuit Breaker ---
# GATEWAY_CIRCUIT_BREAKER_MAX=100
# GATEWAY_CIRCUIT_BREAKER_WINDOW_MS=10000
# GATEWAY_CIRCUIT_BREAKER_PAUSE_MS=300000

# --- Fleet ---
# FLEET_DATA_DIR=/data/fleet
# FLEET_IMAGE_ALLOWLIST=ghcr.io/wopr-network/wopr:*
# FLEET_TEMPLATES_DIR=
# INSTANCE_DATA_DIR=/data/instances
# WOPR_HOME_BASE=/data/instances
# SNAPSHOT_DIR=/data/snapshots
# PLUGIN_VOLUME_PATH=/data/plugins

# --- Shared Node Modules (fleet containers) ---
# SHARED_NODE_MODULES_ENABLED=true
# SHARED_NODE_MODULES_VOLUME=wopr-shared-node-modules
# SHARED_NODE_MODULES_MOUNT=/shared/node_modules

# --- Container Registry (optional — for private images) ---
# REGISTRY_USERNAME=
# REGISTRY_PASSWORD=
# REGISTRY_SERVER=

# --- DigitalOcean (optional — for VPS provisioning) ---
# DO_API_TOKEN=
# DO_SSH_KEY_ID=
# DO_DEFAULT_REGION=
# DO_DEFAULT_SIZE=
# DO_GPU_DEFAULT_REGION=nyc1
# DO_GPU_DEFAULT_SIZE=gpu-h100x1-80gb
# GPU_NODE_SECRET=

# --- Node Agent (set on provisioned nodes, not on platform) ---
# NODE_SECRET=
# NODE_ID=
# REGISTRATION_TOKEN=
# HEARTBEAT_INTERVAL_MS=
# CREDENTIALS_PATH=/etc/wopr/credentials.json
# BACKUP_DIR=

# --- Observability (optional) ---
# SENTRY_DSN=
# PAGERDUTY_ENABLED=false
# PAGERDUTY_ROUTING_KEY=
# PAGERDUTY_AFTER_HOURS_ROUTING_KEY=
# PAGERDUTY_BUSINESS_HOURS_START=09:00
# PAGERDUTY_BUSINESS_HOURS_END=17:00

# --- Metering ---
# METER_WAL_PATH=./data/meter-wal.jsonl
# METER_DLQ_PATH=./data/meter-dlq.jsonl
# METER_MAX_RETRIES=

# --- Affiliate ---
# AFFILIATE_BASE_URL=https://wopr.network/join?ref=
# AFFILIATE_MATCH_RATE=
# AFFILIATE_MAX_REFERRALS_30D=
# AFFILIATE_MAX_MATCH_CREDITS_30D=
# AFFILIATE_NEW_USER_BONUS_RATE=
# DIVIDEND_MATCH_RATE=

# --- Backup Encryption (optional) ---
# BACKUP_ENCRYPTION_KEY=

# --- Onboarding ---
# ONBOARDING_ENABLED=true
# ONBOARDING_WOPR_PORT=3847
# ONBOARDING_LLM_PROVIDER=anthropic
# ONBOARDING_LLM_MODEL=claude-sonnet-4-20250514
# ONBOARDING_WOPR_DATA_DIR=/data/platform/onboarding-wopr
# WOPR_BIN=wopr

# --- DHT / Discovery ---
# DHT_NODE_COUNT=
# DHT_BASE_PORT=
# DHT_IMAGE=
# DHT_BOOTSTRAP_ADDRESSES=
# DISCOVERY_DEFAULT_TOPIC=

# --- Misc ---
# PORT=3100
# LOG_LEVEL=info
# CERT_CHECK_DOMAINS=
# TRUSTED_PROXY_IPS=
# ADMIN_WEBHOOK_URL=
