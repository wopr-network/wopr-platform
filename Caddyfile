# Global options — Cloudflare DNS challenge for wildcard TLS
{
	acme_dns cloudflare {env.CLOUDFLARE_API_TOKEN}
}

# Landing page — root domain (marketing)
{$DOMAIN} {
	reverse_proxy platform-ui:3000
}

# Platform UI — app subdomain (authenticated dashboard)
app.{$DOMAIN} {
	reverse_proxy platform-ui:3000
}

# Platform API — api subdomain
# NOTE: Set TRUSTED_PROXY_IPS env var on platform-api to this container's
# Docker network IP (e.g. 172.18.0.5) so the rate limiter trusts XFF from Caddy.
api.{$DOMAIN} {
	reverse_proxy platform-api:3100
}

# Staging — staging subdomain (only active if the staging container exists)
staging.{$DOMAIN} {
	reverse_proxy platform-ui-staging:3000
}

# Tenant subdomain routing — *.wopr.bot → platform-api resolves to container
*.{$DOMAIN} {
	reverse_proxy platform-api:3100
}
